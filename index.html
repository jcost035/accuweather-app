<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
</head>


<body class="flex flex-col space-y-12 bg-gradient-to-br from-yellow-200 to-orange-500 min-h-screen">

    <form id="weatherForm" class="mx-auto w-4/5 mt-20 flex flex-row space-x-3 justify-center">
        <label for="city" class="my-auto text-2xl text-white" style="font-family: 'Bebas Neue', sans-serif;">
          Enter City Name:
        </label>
        <input type="text" id="city" name="city" class="w-1/3 rounded-lg px-2" required>
        <button type="submit" class="bg-blue-700 hover:bg-blue-400 rounded p-2 text-white" style="font-family: 'Roboto', sans-serif;">
          Get Weather
        </button>
        <div class="my-auto flex items-center space-x-2">
          <label class="relative inline-flex items-center cursor-pointer">
            <input type="checkbox" id="tempToggle" class="sr-only peer">
            <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-500 dark:peer-focus:ring-blue-800 rounded-full peer dark:bg-gray-700 peer-checked:bg-blue-600">
            </div>
            <div class="absolute left-1 top-1 bg-white w-4 h-4 rounded-full transition-transform peer-checked:translate-x-5"></div>
          </label>
          <span class="text-white">Temperature toggle</span>
        </div>
    </form>


    <div id="weatherResult" class="hidden flex flex-row p-8 space-x-4 bg-white w-2/5 mx-auto rounded-lg">
        <div class="flex flex-col space-y-2 w-3/5">
            <span id="location" class="text-2xl"></span>
            <div class="flex flex-row space-x-2 items-center">
                <i id="sun" class="hidden fa-regular fa-sun text-7xl text-orange-400"></i>
                <i id="moon" class="fa-regular fa-moon text-7xl text-blue-800"></i>
                <span id="temperatureResult" class="text-4xl text-end"></span>
            </div>
        </div>
        <div class="flex flex-col space-y-2 pl-2 w-full divide-y">
            <div class="w-full flex flex-row justify-between">
                <span>Conditions:</span> 
                <span id="weatherText" class="font-bold"></span>
            </div>
            <div class="w-full flex flex-row justify-between">
                <span>Wind Speed:</span>
                <span id="wind" class="font-bold"></span>
            </div>
            <div class="w-full flex flex-row justify-between">
                <span>Wind Gusts:</span>
                <span id="gust" class="font-bold"></span>
            </div>
            <div class="w-full flex flex-row justify-between">
                <span>UV Index:</span>
                <span id="uvIndex" class="font-bold"></span>
            </div>
        </div>
    </div>


    <script>
        const checkbox = document.getElementById('tempToggle');

        let isChecked = checkbox.checked;
        let temperature = null;
        let data = null;

        checkbox.addEventListener('change', function() {
            isChecked = checkbox.checked;
            console.log('Checkbox is checked:', isChecked);

            if(temperature)
            {
                temperature = isChecked ? data.tempC + " 째C" : data.tempF + " 째F";

                document.getElementById('temperatureResult').innerText = temperature;
            }
        });

        document.getElementById('weatherForm').addEventListener('submit', async function (event) {
            event.preventDefault();

            const city = document.getElementById('city').value;
            const response = await fetch(`/dummyweather?city=${encodeURIComponent(city)}`);
            data = await response.json();

            if(data.weatherText.length) document.getElementById('weatherResult').classList.remove('hidden');

            setDayIcon();

            document.getElementById('weatherText').innerText = data.weatherText;
            document.getElementById('wind').innerText = data.wind + " MPH";
            document.getElementById('gust').innerText = data.gust + " MPH";
            document.getElementById('uvIndex').innerText = data.UVIndex;
            document.getElementById('location').innerText = data.location;

            temperature = isChecked ? data.tempC + " 째C" : data.tempF + " 째F";
            document.getElementById('temperatureResult').innerText = temperature;
        });

        function setDayIcon() {
            let sun = document.getElementById('sun');
            let moon = document.getElementById('moon');
            if(data.isDayTime) {
                sun.classList.remove('hidden');
                moon.classList.add('hidden')
            }
            else {
                moon.classList.remove('hidden');
                sun.classList.add('hidden')
            }
        }
    </script>
</body>
</html>